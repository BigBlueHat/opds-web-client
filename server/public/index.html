<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>OPDS Browser</title>
    <script src="http://localhost:8090/webpack-dev-server.js"></script>
    <style>
      body { margin: 0; }
    </style>
  </head>
  <body>
    <div id="opds-browser"></div>
    <script src="http://localhost:8090/dist/opds-browser.js"></script>
    <script>
      var getParameterByName = function(name) {
        var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
        return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
      };

      window.onpopstate = function(event) {
        if (event.state && event.state.collectionUrl) {
          // call loadUrl with skipOnFetch = true
          // so that state isn't pushed every time it's popped
          browser.loadUrl(event.state.collectionUrl, true);
        } else {
          browser.clearUrl();
        }
      };

      var startUrl = getParameterByName("url");
      var browser = new OPDSBrowser({
        startUrl: startUrl,
        onFetch: function(url) {
          window.history.pushState({ collectionUrl: url }, url, "?url=" + encodeURIComponent(url));
        }
      }, "opds-browser");

      if (startUrl) {
        // give history state of initial load a collectionUrl for later use by onpopstate
        window.history.replaceState({ collectionUrl: startUrl }, startUrl, "?url=" + encodeURIComponent(startUrl));
      }
    </script>
  </body>
</html>
